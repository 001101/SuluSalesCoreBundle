define(["text!sulusalescore/components/item-quantity-table/item.form.html","text!sulusalescore/components/item-quantity-table/item.row.html","text!sulusalescore/components/item-quantity-table/item.row-head.html"],function(a,b,c){"use strict";var d={data:[],itemsData:[],processedQuantityValueName:"shippedItems",processedItems:null,canAddRemove:!1,showFinishedItems:!0,isEditable:!0,translations:{}},e={formId:"#item-table-form",listClass:".item-table-list",productSearchClass:".product-search",rowIdPrefix:"item-table-row-",rowClass:".item-table-row",quantityRowClass:".item-quantity",quantityInput:".quantity-input input"},f={rowClass:null,rowNumber:null,rowId:"",id:null,item:{id:null,name:"",number:"",quantity:"",quantityUnit:"pc",price:"",discount:null,overallPrice:"",currency:"EUR",useProductsPrice:!1,tax:0},processedQuantity:null,quantity:null},g="sulu.item-table.",h=g+"changed",i=function(){return{rowClass:"header",name:this.sandbox.translate("salescore.item.product"),number:this.sandbox.translate("salescore.item.number"),quantity:this.sandbox.translate("salescore.item.quantity"),quantityInput:this.sandbox.translate("salescore.item.quantity"),quantityUnit:this.sandbox.translate("salescore.item.unit"),price:this.sandbox.translate("salescore.item.price"),discount:this.sandbox.translate("salescore.item.discount"),overallPrice:this.sandbox.translate("salescore.item.overall-value"),processedQuantity:this.sandbox.translate("salescore.item.processed-quantity")}},j=function(){},k=function(){this.sandbox.dom.on(this.$el,"click",p.bind(this),".add-row"),this.sandbox.dom.on(this.$el,"click",n.bind(this),".remove-row"),this.sandbox.dom.on(this.$el,"data-changed",function(a){var b=a.items||[];v.call(this,b)}.bind(this)),this.sandbox.dom.on(this.$el,"change",l.bind(this),e.quantityInput)},l=function(a){var b=m.call(this,a).id;this.items[b].quantity=this.sandbox.dom.val(a.target),y.call(this),this.sandbox.emit(h)},m=function(a){var b=this.sandbox.dom.closest(a.target,".item-table-row"),c=this.sandbox.dom.attr(b,"id");return{row:b,id:c}},n=function(a){a.preventDefault();var b=this.sandbox.dom.closest(a.currentTarget,".item-table-row"),c=this.sandbox.dom.attr(b,"id");q.call(this,c,b)},o=function(a){delete this.items[a],y.call(this)},p=function(a){a.preventDefault(),u.call(this)},q=function(a,b){this.sandbox.dom.remove(b),this.rowCount--,o.call(this,a),t.call(this,b),this.sandbox.emit(h)},r=function(a,c){var d,g,h,i=0;return c!==!1&&this.rowCount++,this.options.processedItems?(h=a.item.id,i=this.options.processedItems[h]):a.hasOwnProperty(this.options.processedQuantityValueName)&&(i=a[this.options.processedQuantityValueName]),!this.options.showFinishedItems&&0===a.quantity&&a.quantity-i<1?void 0:(d=this.sandbox.util.extend({},f,a,{rowId:e.rowIdPrefix+this.rowCount,rowNumber:this.rowCount,isEditable:this.options.isEditable,canAddRemove:this.options.canAddRemove,processedQuantity:i}),g=this.sandbox.util.template(b,d),this.sandbox.dom.createElement(g))},s=function(a){var b=r.call(this,a);return this.sandbox.dom.append(this.$find(e.listClass),b),b},t=function(a){this.sandbox.form.removeField(e.formId,this.sandbox.dom.find(e.quantityInput,a)),this.sandbox.form.removeField(e.formId,this.sandbox.dom.find(e.priceInput,a)),this.sandbox.form.removeField(e.formId,this.sandbox.dom.find(e.discountInput,a))},u=function(){var a,b={rowClass:"new"};a=s.call(this,b),initProductSearch.call(this,a)},v=function(a){this.items={},this.sandbox.dom.empty(this.$find(e.listClass)),w.call(this,a)},w=function(a){var b,c,d,e,f;for(b=-1,c=a.length;++b<c;)d=a[b],e=s.call(this,a[b]),f=this.sandbox.dom.attr(e,"id"),this.items[f]=d;y.call(this)},x=function(){var a=this.sandbox.util.extend({canAddRemove:this.options.canAddRemove},f,i.call(this)),b=this.sandbox.util.template(c,a);this.sandbox.dom.append(this.$find(e.listClass),b)},y=function(){this.sandbox.dom.data(this.$el,"items",this.getItems())},z=function(a){var b,c;for(b in this.options.data)if(c=this.options.data[b].item,c.id===a)return this.options.data[b];return null},A=function(){var a,b,c,d=[];for(a in this.options.itemsData)c=this.options.itemsData[a],b=z.call(this,c.id),b||(b=this.sandbox.util.extend({},f,{item:c})),d.push(b);return this.options.data=d,d},B=function(){this.sandbox.form.create(e.formId)};return{initialize:function(){var a;this.options=this.sandbox.util.extend({},d,this.options),this.items={},this.rowCount=0,this.table=null,this.isEmpty=this.items.length,a=this.sandbox.dom.data(this.$el,"items"),0===this.options.data.length&&a&&a.length>0&&(this.options.data=a),A.call(this),this.render(),j.call(this),k.call(this),y.call(this)},render:function(){var b=this.sandbox.util.extend({},{addText:this.sandbox.translate("salescore.item.add"),isEditable:this.options.isEditable,canAddRemove:this.options.canAddRemove},this.options.data);this.table=this.sandbox.util.template(a,b),this.html(this.table),x.call(this),w.call(this,this.options.data),B.call(this)},getItems:function(){var a,b=[];for(a in this.items)b.push(this.items[a]);return b}}});